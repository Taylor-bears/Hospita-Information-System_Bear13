# 数据的逻辑描述

针对医院信息系统的主要数据元素，依据“静态/动态”分类对名称、定义、单位、值域、格式、类型与约束进行归档说明，便于设计、实现与后续扩展。

## 2 数据的逻辑描述

### 2.1 静态数据

| 名称（缩写/代码） | 定义/物理意义 | 单位 | 值域 | 格式 | 类型 | 约束/说明 |
| --- | --- | --- | --- | --- | --- | --- |
| 科室代码（dept_code） | 医院科室唯一编码 | 无 | 预置枚举 | 字符串（最长10） | varchar | 唯一；由运维配置 |
| 角色与权限（role_perm） | 角色标识与接口/菜单权限表 | 无 | 预置枚举 | JSON | json | 启动前加载，运行期只读 |
| 诊疗项目目录（svc_catalog） | 挂号/治疗/检查项目清单 | 元 | 非负 | 字符串/金额 | varchar/decimal(10,2) | 项目编码唯一；金额两位小数 |
| 药品基础信息（drug_master） | 药品编码、剂型、规格、单价 | 元、毫升、克 | 非负 | 多字段 | varchar/decimal | 药品编码唯一；价格两位小数 |
| 医保/地区对照（ins_map） | 医保项目与院内项目映射表 | 无 | 预置枚举 | 字符串 | varchar | 由医保对接维护，低频更新 |

### 2.2 动态输入数据

| 名称（缩写/代码） | 定义/物理意义 | 单位 | 值域 | 格式 | 类型 | 来源 |
| --- | --- | --- | --- | --- | --- | --- |
| 挂号请求（reg_req） | 患者发起的挂号信息 | 元 | 金额 ≥ 0 | JSON | json | 前端录入/接口 |
| 预约请求（appt_req） | 患者预约医生/时段 | 无 | 受排班约束 | JSON | json | 前端/小程序 |
| 医嘱录入（order_in） | 医生开立检查/检验/处方 | 无/元 | 合法诊疗项目 | JSON | json | 医生工作站 |
| 库存出入单（inv_io_in） | 药房入库、出库、退库申请 | 件/盒/毫升 | 非负 | JSON | json | 药房终端/接口 |
| 支付/结算请求（pay_req） | 结算金额、渠道、幂等键 | 元 | 金额 ≥ 0 | JSON | json | 前端/医保接口 |

### 2.3 动态输出数据

| 名称（缩写/代码） | 定义/物理意义 | 单位 | 值域 | 格式 | 类型 | 去向 |
| --- | --- | --- | --- | --- | --- | --- |
| 挂号/预约确认（reg_appt_resp） | 成功确认的单号、时间、科室 | 无 | 单号为UUID | JSON | json | 前端界面/短信 |
| 检验/检查报告（lab_report） | 检验结果、参考值、结论 | 见项目 | 项目值域 | PDF/JSON | blob/json | 患者端/医生端/打印 |
| 医嘱执行状态（order_status） | 医嘱执行、取消、完成状态 | 无 | scheduled/confirmed/completed/cancelled/pending | JSON | json | 前端/医生端 |
| 结算票据（invoice） | 费用明细、发票号码、支付渠道 | 元 | 金额 ≥ 0 | PDF/JSON | blob/json | 患者端/打印/对账 |
| 库存回执（inv_io_resp） | 入库/出库/退库结果与结余 | 件/盒/毫升 | 非负 | JSON | json | 药房终端/接口 |

### 2.4 内部生成数据

| 名称（缩写/代码） | 定义/物理意义 | 单位 | 值域 | 格式 | 类型 | 约束/说明 |
| --- | --- | --- | --- | --- | --- | --- |
| 操作/审计日志（audit_log） | 用户操作、接口调用记录 | 无 | 文本 | 文本/JSON | text/json | 保留≥90天，脱敏存储 |
| 队列消息（mq_msg） | 异步任务消息（通知、同步） | 无 | 预置枚举 | JSON | json | 幂等键，重试上限 |
| 缓存键值（cache_kv） | 高频读取的会话、排班、配置 | 无 | 受业务值域 | JSON | json | 设定TTL，键名防冲突 |
| 结算中间表（settle_tmp） | 费用分摊/对账临时数据 | 元 | 金额 ≥ 0 | 表记录 | decimal | 事务内使用，定期清理 |
| 监控指标（metrics） | 性能/错误/容量指标 | 次、毫秒、个 | 非负 | 时序点 | float/int | 按周期聚合，保留策略 |

### 2.5 数据约定

- 标识规范：患者ID、医嘱号、发票号、挂号/预约单号唯一，不可复用；使用UUID或业务前缀+自增并配合幂等键。  
- 格式要求：身份证18位校验，手机号11位；时间统一 `YYYY-MM-DD HH:MM:SS` 且使用统一时区；金额保留两位小数。  
- 容量/性能：排班/预约单日容量按科室配置（默认 ≤ 2000 条/科室/日）；消息队列堆积阈值告警；日志与缓存设定上限与淘汰策略。  
- 安全与合规：敏感字段（姓名、证件号、手机号）存储加密/传输HTTPS；接口鉴权与权限校验；审计日志不可篡改。  
- 数据一致性：涉及库存扣减、收费结算的写操作要求事务；对外回调需幂等处理；跨系统映射需维持对照表版本号。  
- 归档与保留：业务数据按法规（如诊疗记录≥15年）保留；临时与缓存数据按TTL清理；备份需定期验证可恢复性。  
- 编码与字符集：统一使用 UTF-8；文本存储避免混用全角/半角，必要时在入库时规范化。  
